# infotecs_test

## usage
1. **Сборка и запуск**
    - Для сборки и запуска программы есть цель в Makefile:
```
make run
```

2. **Процесс сборки**
    - Эта цель соберет все .cpp файлы из папки buffer_lib в одну статическую библиотеку, объектные файлы будут лежать в папке obj/buffer_lib, из объектных файлов собирается статическая бибилотека (buffer.a), которая будет лежать в корне папки obj.
    - После сборки статической библиотеки к ней подключается файл main.cpp из корня проекта, после этого компилируется бинарный файл с названием buffer в папку bin.
Эта цель тянет за собой так же проверку на стиль (clang-format).

### run
---
1. **Что делать после запуска**
    - После того, как вы напишете make run, запустится программа, запросит у вас число от 1 до 8 на вход, чтобы сделать какоето действие с буфером. 
    - Чтобы имитировать тяжёлую нагрузку и чтобы можно было отследить, что действительно в программе есть два потока я сделал так, при нажатии на 1 в буфер вставляется 200 000 интов (это занимает примерно 2-3 секунды), в это время можно дополнительно дать задачу как первому (удаление, сортировка, ещё одна вставка, и т.д) так и второму (чтение) потоку. 
    - Пока выполняется вставка этих элементов, можно вводить число 7 (оно отвечает за чтение буфера, чтение заключается в подсчёте количества элементов, в цикле происходит проход по каждому элементу буфера), тем самым можно наглядно выидеть как заполняется буфер.
    - При выходе из программы сначала выполняются все задачи из очереди, поэтому программа может завершаться не моментально после ввода числа 8 (именно она отвечает за выход).
2. **Логи**
    - Каждый раз, когда пользователь вводит новую задачу создается лог, что за задача была создана пользователем и в какое вермя, когда очередь задач выполняется, создается лог с сообщением `Tasks completed`. Все логи хранятся в папке `log/`, можно прямо во время работы программы наблюдать появление логов. 

## about
1. **Как всё работает**
    - Для данной программы реализованы три основных класса, Logger, TaskManager и шаблонный класс Buffer. Все действия происходят в пространстве имён infotecsTest.
    - В буфере основой всего является вектор, по сути Buffer это небольшая обёртка для вектора. В нём реализованы основные методы, которые требовались в задании.
    ---
    - TaskManager - при создании объекта этого класса в конструкторе создается поток, в котором ожидается получение какой-либо задачи для выполнения. При появлении задачи запускается вложенный цикл, который выполняет все задачи из очереди `tasks`. Добавление очереди происхдоит через метод `addTask`, в который отдаётся лямбда функция. Чтобы остановить бесконечный цикл, ожидающий задачу, существует метод `stop`.
    - В данной программе два 'таск менеджера', если поступает запрос на чтение, то он идёт в переменную tRead, все остальные запросы отправляются в переменную tChange. Само взаимодействие происходит через main поток.
    ---
    - Logger - класс для создания логов. В каждой переменной класса TaskManager свой логгер, который пишет в свой лог файл, чтобы не было путаницы в логах и не нагружать программу лишними мьютексами.


### **Мой гитхаб - https://github.com/lavernac/infotecs_test/**